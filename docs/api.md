
# `/api/chat` 

This API uses the HTTP POST method for requests and requires setting the Authorization header as a token.

## Request Format

The request format is as follows:

```
POST /api/chat HTTP/1.1
Authorization: Bearer YOUR_TOKEN

{
  "model": "openbuddy-13b-v1.3-fp16",
  "messages": [
    {
      "role": "user",
      "content": "test"
    }
  ],
  "temperature": 0.5,
  "max_new_tokens": 700,
  "conversation_id": genUUID4(),
  "user_id": getUserID()
}
```

## Request Parameters

The request parameters include the following fields:

- `model`: The name of the chosen model, for example: "openbuddy-13b-v1.3-fp16".
- `messages`: An array of conversation messages, each element is an object containing a role ("user" or "assistant") and content.
- `temperature`: A value that controls the randomness of the AI-generated result, ranging between 0 and 0.9. The higher the value, the more random the result.
- `max_new_tokens`: The maximum number of new tokens that the AI can generate in each response.
- `conversation_id`: Conversation UUID, generated by the client.
- `user_id`: User ID, for moderation purposes.

## Response Format

The response is a stream of JSON lines, each line separated by "\n", and each is a JSON object. For example:

```
{"o":"Hello! How can I "}
{"o":"help you today?\n"}
{"done":true}
```

The response object may include the following fields:

- `o`: Text fragment
- `done`: Indicates that the generation is completed
- `err`: Error message

## Data Processing

Since data in TCP transmission may be split or merged, it cannot be assumed that the data transmitted each time is a line or a complete UTF8 string. Therefore, the client needs to cache the data into a buffer and continuously find the "\n" byte from the buffer, finding and processing complete lines.

## Error Handling

The `err` field might be generated at the beginning or during the generation process. If an error occurs before generating any text, it should be processed as an error. If an error occurs after a portion of the text has been generated, the generated portion can be retained and treated as a normal result, saved to the session record, and prepared for the next interaction.

